#!/bin/bash
root=$1
run=$2
numthreads=$3

rm -rf ${root}/nodeverification/${run}-${numthreads}threads
mkdir ${root}/nodeverification/${run}-${numthreads}threads

cat ${root}/RunStatus/successful_dockings  | cut -d ' ' -f 1 | uniq > ${root}/nodeverification/${run}-${numthreads}threads/successful_docking_dirs

while IFS= read -r line
do
  # echo checking $line
  grep "DOCKED: USER    (2) Final Total Internal Energy" ${root}/Dockings/$line/$line.dlg | sort  > ${root}/nodeverification/${run}-${numthreads}threads/current_verification_same_seed_dlg
  diffnum=`diff ${root}/nodeverification/master_verification_same_seed_dlg-O3-${numthreads}threads ${root}/nodeverification/${run}-${numthreads}threads/current_verification_same_seed_dlg | wc -l`
  if [ 0 != $diffnum ]; then 
    echo $line is different from master on node `grep "$line " ${root}/RunStatus/successful_dockings | cut -d ' ' -f 9 | uniq` >> ${root}/nodeverification/${run}-${numthreads}threads/diffsummary
    
    cp ${root}/nodeverification/${run}-${numthreads}threads/current_verification_same_seed_dlg ${root}/nodeverification/${run}-${numthreads}threads/current_verification_same_seed_dlg-$line    

  # else
    # echo $line is same as master     
  fi

done < ${root}/nodeverification/${run}-${numthreads}threads/successful_docking_dirs


